# Money Bharat Finance - Hostinger optimized ruleset

RewriteEngine On
RewriteBase /

# Force HTTPS + canonical www host
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^www\.moneybharatfinance\.com$ [NC]
RewriteRule ^(.*)$ https://www.moneybharatfinance.com/$1 [L,R=301,NE]

# Remove trailing slash (except for root and actual directories)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} .+/$
RewriteRule ^(.+)/$ https://www.moneybharatfinance.com/$1 [L,R=301,NE]

# Allow direct access to sitemap/robots and static exports before SPA fallback
RewriteRule ^sitemap\.xml$ sitemap.xml [L]
RewriteRule ^robots\.txt$ robots.txt [L]

# Prevent directory listing / sensitive files leak
Options -Indexes
FileETag None
DirectoryIndex index.html index.php
<FilesMatch "(^\.|package-lock\.json|yarn\.lock|pnpm-lock\.yaml|\.env)">
  Require all denied
</FilesMatch>

# Security headers
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# Compression and modern MIME declarations
<IfModule mod_mime.c>
  AddType application/javascript .mjs
  AddEncoding gzip .gz
  AddEncoding br .br
  AddType text/javascript .js.gz
  AddType text/css .css.gz
</IfModule>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/javascript application/json application/xml application/xhtml+xml application/rss+xml application/ld+json image/svg+xml
</IfModule>

# Static asset caching tuned for Next.js exports
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/html "access plus 0 seconds"
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType text/javascript "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType application/json "access plus 1 hour"
  ExpiresByType image/avif "access plus 30 days"
  ExpiresByType image/webp "access plus 30 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/svg+xml "access plus 30 days"
  ExpiresDefault "access plus 1 hour"
</IfModule>

<FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|webp|avif)$">
  Header set Cache-Control "public, max-age=604800, immutable"
</FilesMatch>

# SPA/Next export fallback (only hit if file/folder not found)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]
